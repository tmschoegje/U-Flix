#keywords characterizing themes
bevolkingkey = ['inwoner', 'bevolking', 'verhuizing', 'geboren', 'overleden', 'geboorte', 'vestiger', 'vestiging', 'sterfte', 'baby', 'verhuis', 'leeftijds', 'vergrij']
participatiekey = ['verkiezing', 'grootste partij', 'grote winnaar', 'partij', 'stem', 'opkomst', 'kiesgerechtigden', 'uitslag', 'initiatie', 'wijksraad', 'beinvloed', 'buurtactiviteit', 'participatie', 'informatiebijeenkomst', 'stadsgesprek', 'participe', 'burgeragendering', 'burgerinitiatief']
dienstverleningkey = ['websitebezoek', 'media ambassadeur', 'media-ambassadeur', 'digitaal loket', 'communicatiek', 'dienstverlen', 'aanspreekpunt', 'webcare', 'media kana', 'digitale aanvra', 'meldingen']#'utrecht.nl', 'zoekopdracht', 'aanvra', 'klacht',


#websites characterizing themes
bevolking = [
'https://www.utrecht-monitor.nl/bevolking-bestuur/bevolking/huisvesting-en-integratie-vluchtelingen',
'https://www.utrecht-monitor.nl/bevolking-bestuur/bevolking/stand-en-ontwikkeling',
'https://www.utrecht-monitor.nl/bevolking-bestuur/bevolking/samenstelling-naar-groepen']
participatie = [
'https://www.utrecht-monitor.nl/bevolking-bestuur/burgerparticipatie/verkiezingen',
'https://www.utrecht-monitor.nl/bevolking-bestuur/burgerparticipatie/burgerparticipatie-initiatieven']
publieksdienstverlening = [
'https://www.utrecht-monitor.nl/bevolking-bestuur/publieksdienstverlening/publiekscommunicatie',
'https://www.utrecht-monitor.nl/bevolking-bestuur/publieksdienstverlening/burgerzaken-klantcontactcentrum']

wonen = [
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/wonen/woningvoorraad-en-nieuwbouw',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/wonen/woning-buurttevredenheid',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/wonen/koopwoningmarkt',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/wonen/sociale-huur']
milieu = [
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/milieu-duurzaamheid/afval',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/milieu-duurzaamheid/milieu',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/milieu-duurzaamheid/energie']
mobiliteit = [
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/mobiliteit/verkeersveiligheid',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/mobiliteit/fiets',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/mobiliteit/auto',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/mobiliteit/openbaar-vervoer',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/mobiliteit/bereikbaarheid']
openbareruimte = [
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/openbare-ruimte-groen/tevredenheid-aanbod-openbare-ruimte',
'https://www.utrecht-monitor.nl/fysieke-leefomgeving/openbare-ruimte-groen/tevredenheid-staat-openbare-ruimte']

economie = [
'https://www.utrecht-monitor.nl/economie-inkomen/economie/werkgelegenheid',
'https://www.utrecht-monitor.nl/economie-inkomen/economie/economische-ontwikkeling',
'https://www.utrecht-monitor.nl/economie-inkomen/economie/toerisme']
werkinkomen = [
'https://www.utrecht-monitor.nl/economie-inkomen/werk-inkomen/armoede-schuldhulpverlening',
'https://www.utrecht-monitor.nl/economie-inkomen/werk-inkomen/arbeidsparticipatie',
'https://www.utrecht-monitor.nl/economie-inkomen/werk-inkomen/inkomen-uitkeringen']
vastgoed = [
'https://www.utrecht-monitor.nl/economie-inkomen/vastgoed/ontwikkeling-stationsgebied',
'https://www.utrecht-monitor.nl/economie-inkomen/vastgoed/kantorenmarkt',
'https://www.utrecht-monitor.nl/economie-inkomen/vastgoed/bedrijfsruimten-bedrijventerreinen',
'https://www.utrecht-monitor.nl/economie-inkomen/vastgoed/winkelmarkt']

onderwijs = [
'https://www.utrecht-monitor.nl/sociale-leefomgeving/onderwijs-vaardigheden/bibliotheken',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/onderwijs-vaardigheden/het-jonge-kind',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/onderwijs-vaardigheden/leerlingpopulatie-migratie',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/onderwijs-vaardigheden/onderwijsprestaties-tevredenheid']
gezondheid = [
'https://www.utrecht-monitor.nl/sociale-leefomgeving/gezondheid/gezondheid-volwassenen',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/gezondheid/gezondheid-jeugd']
socialekracht = [
'https://www.utrecht-monitor.nl/sociale-leefomgeving/sociale-kracht/sociale-cohesie',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/sociale-kracht/welzijn-zelfredzaamheid',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/sociale-kracht/voorzieningen-ondersteuning-jeugd',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/sociale-kracht/voorzieningen-ondersteuning-volwassenen',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/sociale-kracht/maatschappelijke-participatie',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/sociale-kracht/digitale-vaardigheden']
veiligheid = [
'https://www.utrecht-monitor.nl/sociale-leefomgeving/veiligheid/jongerenoverlast',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/veiligheid/criminaliteitsontwikkeling',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/veiligheid/veiligheidsbeleving']
cultuur = [
'https://www.utrecht-monitor.nl/sociale-leefomgeving/cultuur/cultureel-aanbod-tevredenheid',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/cultuur/cultuurdeelname']
sportvrijetijd = [
'https://www.utrecht-monitor.nl/sociale-leefomgeving/sport-vrije-tijd/recreatie',
'https://www.utrecht-monitor.nl/sociale-leefomgeving/sport-vrije-tijd/sportdeelname-tevredenheid']

bevolkingbestuur = [bevolking, participatie, publieksdienstverlening]
fysiekeleefomgeving = [wonen, milieu, mobiliteit, openbareruimte]
economieinkomen = [economie, werkinkomen, vastgoed]
socialeleefomgeving = [onderwijs, gezondheid, socialekracht, veiligheid, cultuur, sportvrijetijd]
themes = [bevolkingbestuur, fysiekeleefomgeving, economieinkomen, socialeleefomgeving]

import urllib.request
import re
import html2text
from sklearn.model_selection import train_test_split

h = html2text.HTML2Text()
h.ignore_links = True

targets = [bevolking, participatie, publieksdienstverlening]
themekeys = [bevolkingkey, participatiekey, dienstverleningkey]


def count(content, themeid):
	count = 0
#	totalcount = 0
	for page in targets[themeid]:
		for keyword in themekeys[themeid]:
			#count += content.count(keyword)
			#print(str(keyword) + ' is in ' + str(themeid) + ' ' + str(content.count(keyword)) + ' times')
			count += keyword in content
#		for keyword in themekeys[0]:
#			totalcount += keyword in content
#		for keyword in themekeys[1]:
#			totalcount += keyword in content
#		for keyword in themekeys[2]:
#			totalcount += keyword in content
#	print(count + ' out of ' + totalcount + ' for ' + keyword)
	return count

#test how many times a keyword is mentioned on all pages, compared to the ones
#of the proper theme
def wrongcount(themeid):
	count = 0
	totalcount = 0
	for keyword in themekeys[themeid]:
		for page in targets[0]:
			content = h.handle(str(urllib.request.urlopen(page).read()))
			totalcount += content.count(keyword)
		for page in targets[1]:
			content = h.handle(str(urllib.request.urlopen(page).read()))
			totalcount += content.count(keyword)
		for page in targets[2]:
			content = h.handle(str(urllib.request.urlopen(page).read()))
			totalcount += content.count(keyword)
		for page in targets[themeid]:
			content = h.handle(str(urllib.request.urlopen(page).read()))
			count += content.count(keyword)
		print(str(count) + ' out of ' + str(totalcount) + ' for ' + keyword)

#Function to annotate a page given the keyword desks
def annotate(page):
	results = []
	for themeid in range(0, len(targets)):
		content = h.handle(str(urllib.request.urlopen(page).read()))
		results.append(count(content, themeid))
	max_value = max(results)
	print(results)
#	print(results.index(max_value))
	return (results.index(max_value))

#Function to annotate a string given the keyword desks
def annotatecontent(content):
	results = []
	for themeid in range(0, len(targets)):
#		content = h.handle(content)
		results.append(count(content, themeid))
	max_value = max(results)
#	print(results)
#	print(results.index(max_value))
	return (results.index(max_value))
	
#TODO iterate over pages
import pandas as pd

y_true = []
y_pred = []
for i in range(0, len(targets)):
	for page in targets[i]:
#		print('pred ' + str(annotate(page)))
#		print('true ' + str(i))
		y_pred.append(annotate(page))
		y_true.append(i)

import numpy as np

def confusionmatrix(y_true, y_pred):
	matrix = np.zeros((3, 3))
	for i in range(0, len(y_pred)):
		matrix[y_pred[i], y_true[i]] += 1
	
#	for x in range(0, len(y_true)):
#		for y in range(0, len(y_pred)):
#			matrix[y_true[x], y_pred[y]] += 1
			
	print(matrix)

confusionmatrix(y_true, y_pred)
#train_test_split(y_pred, y_true)

def testkeywords():
	for i in range(0, 3):
		print('testing keywords in theme ' + str(i))
		wrongcount(i)

#testkeywords()

#print(annotate('https://www.utrecht-monitor.nl/bevolking-bestuur/bevolking/huisvesting-en-integratie-vluchtelingen'))